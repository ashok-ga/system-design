
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ashok-ga.github.io/system-design/hld/DE%20Shaw%20HLD%20with%20Implementations/URL%20Shortener%20%28Global%29/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>URL Shortener (Global) - System Design Hub</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#url-shortener-global" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="System Design Hub" class="md-header__button md-logo" aria-label="System Design Hub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            System Design Hub
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              URL Shortener (Global)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ashok-ga/system-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ashok-ga/system-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../overview/" class="md-tabs__link">
          
  
  
  High-Level Design

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../lld/de-shaw.md" class="md-tabs__link">
          
  
  
  Low-Level Design

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../assets/" class="md-tabs__link">
        
  
  
    
  
  Assets

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../references/" class="md-tabs__link">
        
  
  
    
  
  References

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../CONTRIBUTING.md" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="System Design Hub" class="md-nav__button md-logo" aria-label="System Design Hub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    System Design Hub
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ashok-ga/system-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ashok-ga/system-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    High-Level Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            High-Level Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../de-shaw/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DE Shaw
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Low-Level Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Low-Level Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lld/de-shaw.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DE Shaw
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lld/module2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assets
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    References
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../CONTRIBUTING.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-problem-statement-scope" class="md-nav__link">
    <span class="md-ellipsis">
      1. Problem Statement &amp; Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      2. Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-capacity-estimation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Capacity Estimation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-high-level-architecture-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      4. High-Level Architecture Diagram
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-data-schema-api-design" class="md-nav__link">
    <span class="md-ellipsis">
      5. Data Schema &amp; API Design
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-detailed-component-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      6. Detailed Component Breakdown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-end-to-end-flow-shorten-redirect" class="md-nav__link">
    <span class="md-ellipsis">
      7. End-to-End Flow (Shorten &amp; Redirect)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-bottlenecks-fault-tolerance-and-trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      8. Bottlenecks, Fault Tolerance, and Trade-offs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-detailed-component-breakdown_1" class="md-nav__link">
    <span class="md-ellipsis">
      6. Detailed Component Breakdown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-end-to-end-flow-redirect" class="md-nav__link">
    <span class="md-ellipsis">
      7. End-to-End Flow (Redirect)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-bottlenecks-fault-tolerance-and-trade-offs_1" class="md-nav__link">
    <span class="md-ellipsis">
      8. Bottlenecks, Fault Tolerance, and Trade-offs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="url-shortener-global">URL Shortener (Global)<a class="headerlink" href="#url-shortener-global" title="Permanent link">&para;</a></h1>
<h3 id="1-problem-statement-scope">1. Problem Statement &amp; Scope<a class="headerlink" href="#1-problem-statement-scope" title="Permanent link">&para;</a></h3>
<p>Design a global URL shortening service (like bit.ly or tinyurl.com) that generates short aliases for long URLs and provides fast, highly available redirection. The system must handle billions of URLs, massive read traffic, and provide analytics.</p>
<h3 id="2-requirements">2. Requirements<a class="headerlink" href="#2-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Functional Requirements:</strong><ul>
<li>Users can submit a long URL and receive a unique, short URL.</li>
<li>Optionally support custom aliases.</li>
<li>Accessing the short URL redirects to the original long URL.</li>
<li>Track click analytics (usage, geo, referrer).</li>
</ul>
</li>
<li><strong>Non-Functional Requirements:</strong><ul>
<li><strong>Latency:</strong> Redirects must be extremely fast (p99 &lt; 30ms).</li>
<li><strong>Availability:</strong> Five-nines (99.999%) for redirects.</li>
<li><strong>Scalability:</strong> 50k QPS reads, billions of URLs.</li>
<li><strong>Durability:</strong> No lost mappings.</li>
</ul>
</li>
</ul>
<h3 id="3-capacity-estimation">3. Capacity Estimation<a class="headerlink" href="#3-capacity-estimation" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Write Rate:</strong> 10 new URLs/sec.</li>
<li><strong>Read Rate:</strong> 50,000 redirects/sec (read/write = 5000:1).</li>
<li><strong>Storage:</strong> 10B URLs * 600B = 6TB (sharded DB).</li>
</ul>
<h3 id="4-high-level-architecture-diagram">4. High-Level Architecture Diagram<a class="headerlink" href="#4-high-level-architecture-diagram" title="Permanent link">&para;</a></h3>
<p>Code snippet</p>
<p><code>graph TD
    subgraph "Write Path (Shorten)"
        A[User] --&gt; B[API Service];
        B --&gt; C[Code Generation Service];
        B --&gt; D[Database (Sharded)];
    end
    subgraph "Read Path (Redirect)"
        E[User] --&gt; F[Edge CDN/PoP];
        F --&gt; G[Redirector Service];
        G --&gt; H[Cache (Redis)];
        H --&gt; D;
    end
    subgraph "Analytics Path (Async)"
        G -- fire-and-forget --&gt; I[Message Bus (Kafka)];
        I --&gt; J[Stream Processor];
        J --&gt; K[Analytics DB (ClickHouse)];
    end</code></p>
<h3 id="5-data-schema-api-design">5. Data Schema &amp; API Design<a class="headerlink" href="#5-data-schema-api-design" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>API:</strong><ul>
<li><code>POST /v1/shorten</code>: <code>{long_url, custom_alias?}</code> → <code>{short_url}</code></li>
<li><code>GET /{short_code}</code>: Redirect endpoint.</li>
</ul>
</li>
<li><strong>Data Models:</strong><ul>
<li><strong>URLs Table:</strong> <code>short_code, long_url, user_id, created_at, ...</code></li>
<li><strong>Analytics Table:</strong> <code>short_code, ts, ip, geo, referrer, ...</code></li>
</ul>
</li>
</ul>
<h3 id="6-detailed-component-breakdown">6. Detailed Component Breakdown<a class="headerlink" href="#6-detailed-component-breakdown" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>API Service:</strong> Handles URL shortening requests, validates input, and stores mappings.</li>
<li><strong>Code Generation Service:</strong> Generates unique short codes, checks for collisions, supports custom aliases.</li>
<li><strong>Database (Sharded):</strong> Stores mappings, sharded for scale.</li>
<li><strong>Edge CDN/PoP:</strong> Caches redirects close to users for low latency.</li>
<li><strong>Redirector Service:</strong> Looks up short code, issues HTTP 301/302 redirect.</li>
<li><strong>Cache (Redis):</strong> Caches hot mappings for fast lookup.</li>
<li><strong>Message Bus (Kafka):</strong> Streams click events for analytics.</li>
<li><strong>Stream Processor:</strong> Aggregates analytics, writes to analytics DB.</li>
<li><strong>Analytics DB (ClickHouse):</strong> Stores and serves analytics queries.</li>
</ul>
<h3 id="7-end-to-end-flow-shorten-redirect">7. End-to-End Flow (Shorten &amp; Redirect)<a class="headerlink" href="#7-end-to-end-flow-shorten-redirect" title="Permanent link">&para;</a></h3>
<p>Code snippet</p>
<p>`sequenceDiagram
    participant User
    participant API
    participant CodeGen
    participant DB
    participant CDN
    participant Redirector
    participant Cache
    participant Kafka
    participant Analytics</p>
<div class="codehilite"><pre><span></span><code><span class="n">User</span><span class="o">-&gt;&gt;</span><span class="nl">API:</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="o">/</span><span class="n">shorten</span>
<span class="n">API</span><span class="o">-&gt;&gt;</span><span class="nl">CodeGen:</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">code</span>
<span class="n">CodeGen</span><span class="o">-&gt;&gt;</span><span class="nl">DB:</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="n">mapping</span>
<span class="n">DB</span><span class="o">--&gt;&gt;</span><span class="nl">API:</span><span class="w"> </span><span class="n">Ack</span>
<span class="n">API</span><span class="o">--&gt;&gt;</span><span class="nl">User:</span><span class="w"> </span><span class="n">Return</span><span class="w"> </span><span class="n">short_url</span>
<span class="n">User</span><span class="o">-&gt;&gt;</span><span class="nl">CDN:</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="p">{</span><span class="n">short_code</span><span class="p">}</span>
<span class="n">CDN</span><span class="o">-&gt;&gt;</span><span class="nl">Redirector:</span><span class="w"> </span><span class="n">Lookup</span>
<span class="n">Redirector</span><span class="o">-&gt;&gt;</span><span class="nl">Cache:</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">cache</span>
<span class="n">alt</span><span class="w"> </span><span class="n">Hit</span>
<span class="w">    </span><span class="n">Cache</span><span class="o">--&gt;&gt;</span><span class="nl">Redirector:</span><span class="w"> </span><span class="n">Return</span><span class="w"> </span><span class="n">long_url</span>
<span class="k">else</span><span class="w"> </span><span class="n">Miss</span>
<span class="w">    </span><span class="n">Redirector</span><span class="o">-&gt;&gt;</span><span class="nl">DB:</span><span class="w"> </span><span class="n">Lookup</span>
<span class="w">    </span><span class="n">DB</span><span class="o">--&gt;&gt;</span><span class="nl">Redirector:</span><span class="w"> </span><span class="n">Return</span><span class="w"> </span><span class="n">long_url</span>
<span class="w">    </span><span class="n">Redirector</span><span class="o">-&gt;&gt;</span><span class="nl">Cache:</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">cache</span>
<span class="k">end</span>
<span class="n">Redirector</span><span class="o">--&gt;&gt;</span><span class="nl">User:</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="mh">301</span><span class="o">/</span><span class="mh">302</span>
<span class="n">Redirector</span><span class="o">-&gt;&gt;</span><span class="nl">Kafka:</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="n">click</span>
<span class="n">Kafka</span><span class="o">-&gt;&gt;</span><span class="nl">Analytics:</span><span class="w"> </span><span class="n">Aggregate</span>
</code></pre></div>

<p>`</p>
<h3 id="8-bottlenecks-fault-tolerance-and-trade-offs">8. Bottlenecks, Fault Tolerance, and Trade-offs<a class="headerlink" href="#8-bottlenecks-fault-tolerance-and-trade-offs" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Bottleneck: DB/Cache:</strong><ul>
<li>Use sharding and caching for scale. CDN for global low latency.</li>
</ul>
</li>
<li><strong>Code Generation:</strong><ul>
<li>Ensure uniqueness, avoid collisions. Use random or hash-based codes.</li>
</ul>
</li>
<li><strong>Analytics:</strong><ul>
<li>Async, eventual consistency. Use stream processing for scale.</li>
</ul>
</li>
<li><strong>Trade-offs:</strong><ul>
<li>Write path can be eventually consistent. Read path must be highly available and fast.</li>
</ul>
</li>
</ul>
<hr />
<p>This design is used by Bitly, TinyURL, and other global URL shorteners.
        - <code>short_code VARCHAR(8) PRIMARY KEY,</code>
        - <code>long_url TEXT,</code>
        - <code>created_at TIMESTAMP</code>
    - The choice of <code>short_code</code> as the primary key is perfect for a sharded system, as random-looking codes will distribute the load evenly.</p>
<h3 id="6-detailed-component-breakdown_1">6. Detailed Component Breakdown<a class="headerlink" href="#6-detailed-component-breakdown_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>API Service (Write Path):</strong> Receives the long URL. It calls the <strong>Code Generation Service</strong> to get a unique short code, then writes the mapping (<code>short_code</code> -&gt; <code>long_url</code>) to the database. If a custom alias is requested, it first checks the DB for its availability.</li>
<li><strong>Code Generation Service:</strong> This is a critical component that must produce unique short codes without being a bottleneck.<ul>
<li><strong>Strategy 1 (Snowflake-style):</strong> Use a distributed unique ID generator (like Twitter's Snowflake) to get a 64-bit integer. Then, <strong>Base62-encode</strong> this integer <code>[a-zA-Z0-9]</code>. This produces a ~7-character code, is guaranteed to be unique, and doesn't require a database check.</li>
<li><strong>Strategy 2 (Pre-generation):</strong> Have a background job that generates millions of random, unused codes and stores them in a queue (e.g., in Redis). The API service just pops a code from this queue when needed.</li>
</ul>
</li>
<li><strong>Redirector Service (Read Path):</strong> A fleet of lightweight, stateless servers deployed globally. Their only job is to handle <code>GET /{short_code}</code> requests.<ol>
<li>First, check a multi-layered <strong>cache</strong> (e.g., local in-memory, then a regional Redis cluster).</li>
<li>If it's a cache miss, query the database to get the <code>long_url</code>.</li>
<li>Populate the cache with the result.</li>
<li>Return a <code>301</code> or <code>302</code> redirect.</li>
<li>Asynchronously publish a click event to Kafka for analytics.</li>
</ol>
</li>
<li><strong>Cache:</strong> The most important part of the read path. A very high cache hit rate (&gt;99%) is expected. This shields the database from the massive read traffic. Caching can happen at multiple levels: browser, CDN edge, and the service's regional Redis cluster.</li>
<li><strong>Analytics Pipeline:</strong> A standard streaming pipeline. The fire-and-forget approach ensures that analytics processing adds zero latency to the user-facing redirect.</li>
</ul>
<h3 id="7-end-to-end-flow-redirect">7. End-to-End Flow (Redirect)<a class="headerlink" href="#7-end-to-end-flow-redirect" title="Permanent link">&para;</a></h3>
<p>Code snippet</p>
<p>`sequenceDiagram
    participant UserBrowser
    participant EdgeCDN
    participant RedirectorSvc
    participant RedisCache
    participant Database</p>
<div class="codehilite"><pre><span></span><code><span class="n">UserBrowser</span><span class="o">-&gt;&gt;</span><span class="n">EdgeCDN</span><span class="o">:</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">aBcDeF</span>
<span class="n">Note</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">EdgeCDN</span><span class="o">:</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="n">MISS</span>
<span class="n">EdgeCDN</span><span class="o">-&gt;&gt;</span><span class="n">RedirectorSvc</span><span class="o">:</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">aBcDeF</span>

<span class="n">RedirectorSvc</span><span class="o">-&gt;&gt;</span><span class="n">RedisCache</span><span class="o">:</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="n">short_code</span><span class="o">:</span><span class="n">aBcDeF</span>
<span class="n">Note</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">RedisCache</span><span class="o">:</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="n">MISS</span>
<span class="n">RedisCache</span><span class="o">--&gt;&gt;</span><span class="n">RedirectorSvc</span><span class="o">:</span><span class="w"> </span><span class="n">nil</span>

<span class="n">RedirectorSvc</span><span class="o">-&gt;&gt;</span><span class="n">Database</span><span class="o">:</span><span class="w"> </span><span class="n">SELECT</span><span class="w"> </span><span class="n">long_url</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">short_code</span><span class="o">=</span><span class="s">&#39;aBcDeF&#39;</span>
<span class="n">Database</span><span class="o">--&gt;&gt;</span><span class="n">RedirectorSvc</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;http://very.long.url/...&quot;</span>

<span class="n">RedirectorSvc</span><span class="o">-&gt;&gt;</span><span class="n">RedisCache</span><span class="o">:</span><span class="w"> </span><span class="nf">SET</span><span class="w"> </span><span class="n">short_code</span><span class="o">:</span><span class="n">aBcDeF</span><span class="w"> </span><span class="s">&quot;http://...&quot;</span>

<span class="n">Note</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">RedirectorSvc</span><span class="o">:</span><span class="w"> </span><span class="n">Asynchronously</span><span class="w"> </span><span class="nf">log</span><span class="w"> </span><span class="n">click</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Kafka</span>
<span class="n">RedirectorSvc</span><span class="o">--&gt;&gt;</span><span class="n">EdgeCDN</span><span class="o">:</span><span class="w"> </span><span class="mi">302</span><span class="w"> </span><span class="n">Found</span><span class="p">,</span><span class="w"> </span><span class="n">Location</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;http://...&quot;</span>
<span class="n">EdgeCDN</span><span class="o">--&gt;&gt;</span><span class="n">UserBrowser</span><span class="o">:</span><span class="w"> </span><span class="mi">302</span><span class="w"> </span><span class="n">Found</span><span class="p">,</span><span class="w"> </span><span class="n">Location</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;http://...&quot;</span><span class="err">`</span>
</code></pre></div>

<h3 id="8-bottlenecks-fault-tolerance-and-trade-offs_1">8. Bottlenecks, Fault Tolerance, and Trade-offs<a class="headerlink" href="#8-bottlenecks-fault-tolerance-and-trade-offs_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Bottleneck: Write Path Code Generation:</strong> If we used a naive approach of generating a random code and checking the DB for uniqueness, we would face high latency and collisions at scale. The Snowflake/Base62 approach avoids this central contention.</li>
<li><strong>Fault Tolerance:</strong><ul>
<li><strong>Read Path:</strong> The read path is highly resilient. If the database is temporarily unavailable, the system can continue to serve redirects for all cached entries, degrading gracefully.</li>
<li><strong>Write Path:</strong> The write path is less critical. If it's down for a few minutes, users cannot create new short URLs, but existing ones continue to work.</li>
</ul>
</li>
<li><strong>Key Trade-offs:</strong><ul>
<li><strong>Redirect Type (301 vs. 302):</strong><ul>
<li><strong><code>301 Moved Permanently</code>:</strong> The browser caches this response aggressively. The next time the user clicks the link, the browser may go directly to the long URL without ever contacting our service again. This is great for reducing server load but terrible for analytics and makes it impossible to ever change the destination URL.</li>
<li><strong><code>302 Found</code> (or <code>307 Temporary Redirect</code>):</strong> The browser is instructed that this redirect is temporary and it should always check the short URL first. This ensures our service is hit every time, allowing for 100% accurate analytics and the ability to edit the destination. The trade-off is higher traffic to our servers. For most commercial shorteners, <strong>302/307 is the correct choice.</strong></li>
</ul>
</li>
</ul>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>